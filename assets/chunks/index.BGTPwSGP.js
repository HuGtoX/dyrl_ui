import{u as W}from"./useRequest.BTeUhkZU.js";import"./subscribeFocus.DWRnlB-b.js";import{y as X,z as ee,d as te,h as n,s as p,a5 as se,v as U,Y as re,D as oe,o as i,c,I as m,w as _,n as r,k as t,j as w,r as R,e as v,a as k,P as ae,R as le,t as j,_ as ne}from"./framework.DZLrHpBd.js";import{c as ie}from"./create.BCteNkO5.js";import{g as x}from"./uniCommon.FOji9g2r.js";import ce from"./index.DItzrnwf.js";import{_ as b}from"./index.vue_vue_type_style_index_0_lang.BypVRTwN.js";import{i as M}from"./isEmpty.Ts5sY4Hd.js";import{i as ue}from"./isEqual.TBi3dbYN.js";import"./Uint8Array.s5ylH1oV.js";import"./format.B9x3PRfW.js";import"./index.vue_vue_type_style_index_0_lang.wdkJ4pUc.js";const de=(u,S)=>{const g=async C=>{await S(C)};X(async()=>{u&&uni.$on(u,g)}),ee(()=>{u&&uni.$off(u,g)})},fe={key:1},he={type:"spinner"},pe={options:{styleIsolation:"apply-shared",virtualHost:!0}},me=te({...pe,__name:"index",props:{uniqkey:{},request:{},emptyMode:{},params:{},pageSize:{},customStyle:{},refresherThreshold:{default:40},noMoreText:{default:"没有更多了"},empty:{type:Boolean,default:!0},loadingColor:{}},emits:["change"],setup(u,{expose:S,emit:g}){const[C,o]=ie("list-view"),d=u,A=g,$=async()=>{B()},G=d.uniqkey?`list-${d.uniqkey}`:null;de(G,$);const E=n(()=>d.pageSize??15),q=n(()=>d.params),z=p(!0),I=p(se()),H=n(()=>z.value&&f.value&&!V.value||T.value),{data:s,loading:f,loadingMore:T,loadMore:N,reload:B,mutate:K}=W(async e=>{const a=e?Math.ceil(e.list.length/E.value)+1:1;return z.value=a===1,d.request({current:a,pageSize:E.value,...q.value}).then(l=>({list:l.data||[],total:l.total||0}))},{async onSuccess(){var l;await le();const e=await x("#list-content",I.value),a=await x("#list",I.value);e.height<a.height&&(M((l=s.value)==null?void 0:l.list)||s.value.list.length<s.value.total&&(N(),console.log("watchEffect 自动触底刷新"),P.value=!0))}});U(q,(e,a)=>{ue(e,a)||(K(l=>({...l,list:[]})),console.log("请求参数更新"),$())}),U(s,e=>{A("change",e)});const y=p(!1),h=p(0),V=n(()=>h.value!==0||y.value),Y=n(()=>{var e;return s.value&&((e=s.value)==null?void 0:e.list.length)<s.value.total}),O=n(()=>h.value>d.refresherThreshold+5),L=()=>{y.value=!1,h.value=0},Z=e=>{const a=e.detail.deltaY??e.detail.dy;h.value=a},J=()=>{console.log("-- [ onRefresherRefresh ] --","上拉刷新"),y.value=!0,h.value!==0&&(f.value||B())},P=p(!1),Q=()=>{P.value=!0,T&&!f.value&&Y.value&&(console.log("触底刷新"),N())};return re("data",s),S({data:n(()=>{var e;return(e=s.value)==null?void 0:e.list})}),(e,a)=>{const l=oe("scroll-view");return i(),c("div",{class:r(t(C)),id:"list",style:ae(e.customStyle)},[m(l,{class:r(t(o)("scroll-view")),"refresher-enabled":!0,"scroll-y":!0,"refresher-triggered":t(f),"refresher-threshold":e.refresherThreshold,"refresher-default-style":"none","refresher-background":"var(--rl-list-view-background)","enable-back-to-top":"",onScrolltolower:Q,onRefresherrefresh:J,onRefresherpulling:Z,onRefresherrestore:L,onRefresherabort:L},{default:_(()=>{var D,F;return[V.value?(i(),c("div",{key:0,class:r(t(o)("custom-refresher-view"))},[w("div",{class:r(t(o)("custom-refresher-placeholder"))},null,2),w("div",{class:r(t(o)("custom-refresher-slot-view"))},[y.value?R(e.$slots,"refresh",{key:0},()=>[m(b,{type:"spinner"},{default:_(()=>[k("加载中...")]),_:1})],!0):(i(),c("div",fe,[R(e.$slots,"pre-refresh",{},()=>[k(j(O.value?"释放即可刷新":"继续下拉即可刷新"),1)],!0)]))],2)],2)):v("",!0),w("div",{id:"list-content",class:r(t(o)("content"))},[R(e.$slots,"default",{},void 0,!0)],2),!t(f)&&t(M)((D=t(s))==null?void 0:D.list)&&e.empty?(i(),c("div",{key:1,class:r(t(o)("empty"))},[m(ce,{description:"暂无数据"})],2)):v("",!0),H.value?(i(),c("div",{key:2,class:r(t(o)("loading-more"))},[m(b,{color:e.loadingColor,type:"spinner"},{default:_(()=>[k("加载中...")]),_:1},8,["color"])],2)):v("",!0),t(T)?(i(),c("div",{key:3,class:r(t(o)("loading-more"))},[m(b,{color:e.loadingColor,type:"spinner"},{default:_(()=>[k("加载中...")]),_:1},8,["color"])],2)):v("",!0),!t(f)&&!Y.value&&!t(M)((F=t(s))==null?void 0:F.list)?(i(),c("div",{key:4,class:r(t(o)("no-more"))},[R(e.$slots,"no-more",{},()=>[w("span",he,j(e.noMoreText),1)],!0)],2)):v("",!0)]}),_:3},8,["class","refresher-triggered","refresher-threshold"])],6)}}}),$e=ne(me,[["__scopeId","data-v-c3a71b6a"]]);export{$e as default};
